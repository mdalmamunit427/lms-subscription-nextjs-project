{
  "meta": {
    "project": "Full-Stack Digital Products / Course Subscription Platform",
    "date": "2025-11-19",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A Next.js full-stack platform enabling creators to sell digital courses through a $99 subscription unlocking all premium content instantly. Users authenticate with Clerk and user data syncs to MongoDB. Stripe handles subscription payments. Includes user and admin dashboards with course management and access control.",
  "core_goals": [
    "Enable secure user authentication and sync user profiles with database.",
    "Facilitate a seamless subscription purchase flow via Stripe.",
    "Enforce access control ensuring only subscribed users access premium content.",
    "Provide user dashboards showing subscription status and accessible courses.",
    "Create admin dashboards for managing courses and viewing subscriber data.",
    "Implement automated testing to ensure platform reliability and security."
  ],
  "key_features": [
    "Clerk integration for secure sign-up and sign-in with webhook handling to sync user data to MongoDB.",
    "Subscription purchase via Stripe with backend webhook handling to activate subscriptions.",
    "User model stores Clerk ID, email, names, profile image, subscription status, and roles.",
    "Access control restricting premium course content to subscribed users only.",
    "User dashboard displaying subscription status and available courses.",
    "Admin dashboard for course CRUD operations and subscriber monitoring.",
    "API endpoints for user creation, subscription checkout, webhook handling, course listing, and admin functions.",
    "Robust validation including webhook signature verification and role-based access restrictions."
  ],
  "user_flow_summary": [
    "Users sign up or sign in via Clerk authentication on dedicated pages with optional redirect support.",
    "Upon successful login, webhook syncs user data to MongoDB ensuring consistent user records.",
    "Users purchase a $99 subscription via Stripe checkout; Stripe webhook activates subscription in database.",
    "Subscribed users access premium courses and user dashboard showing subscription and course info.",
    "Admins log in and access admin dashboard to manage courses and subscriber data.",
    "Access control redirects non-subscribed users attempting premium content to pricing page."
  ],
  "validation_criteria": [
    "Webhook signature validation for Clerk and Stripe events.",
    "Database user creation and update on Clerk webhook events without duplication.",
    "Stripe webhook correctly updates subscription flags and expiration dates.",
    "Access control enforces subscription requirements for premium content.",
    "Admin routes require admin role with appropriate permissions.",
    "Frontend sign-in and sign-up pages render correctly and handle redirect parameters.",
    "End-to-end tests to verify login, subscription purchase, content access, and admin actions.",
    "Error handling for missing or invalid webhook headers and invalid input data."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 16",
      "React",
      "Clerk",
      "MongoDB",
      "Mongoose",
      "Stripe",
      "Tailwind CSS"
    ],
    "features": [
      {
        "name": "Clerk Webhook Handler",
        "description": "Handles user creation and updates from Clerk authentication service. Syncs user data to MongoDB when users sign up or update their profile. Validates webhook signatures and handles user.created and user.updated events.",
        "files": [
          "src/app/api/webhooks/clerk/route.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Clerk Webhook API",
            "version": "1.0.0",
            "description": "Webhook endpoint for Clerk authentication events"
          },
          "paths": {
            "/api/webhooks/clerk": {
              "post": {
                "summary": "Handle Clerk webhook events",
                "description": "Receives webhook events from Clerk for user creation and updates. Validates webhook signature and syncs user data to MongoDB.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "enum": [
                              "user.created",
                              "user.updated"
                            ],
                            "description": "Type of webhook event"
                          },
                          "data": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "description": "Clerk user ID"
                              },
                              "email_addresses": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "email_address": {
                                      "type": "string"
                                    }
                                  }
                                }
                              },
                              "first_name": {
                                "type": "string"
                              },
                              "last_name": {
                                "type": "string"
                              },
                              "image_url": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Webhook received successfully"
                  },
                  "400": {
                    "description": "Missing svix headers or invalid webhook signature"
                  },
                  "500": {
                    "description": "Error syncing user to database or missing webhook secret"
                  }
                },
                "parameters": [
                  {
                    "name": "svix-id",
                    "in": "header",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "svix-timestamp",
                    "in": "header",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "svix-signature",
                    "in": "header",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ]
              }
            }
          }
        }
      },
      {
        "name": "Sign In Page",
        "description": "User sign-in page using Clerk authentication. Displays Clerk SignIn component with custom styling. Supports redirect URL parameter for post-login navigation.",
        "files": [
          "src/app/sign-in/[[...sign-in]]/page.tsx"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Sign In Page",
            "version": "1.0.0",
            "description": "Frontend page for user authentication sign-in"
          },
          "paths": {
            "/sign-in": {
              "get": {
                "summary": "Display sign-in page",
                "description": "Renders the Clerk sign-in component with custom styling. Supports optional redirect_url query parameter.",
                "parameters": [
                  {
                    "name": "redirect_url",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    },
                    "description": "URL to redirect to after successful sign-in. Defaults to /dashboard."
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Sign-in page rendered successfully"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Sign Up Page",
        "description": "User sign-up page using Clerk authentication. Displays Clerk SignUp component with custom styling. Supports redirect URL parameter for post-registration navigation.",
        "files": [
          "src/app/sign-up/[[...sign-up]]/page.tsx"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Sign Up Page",
            "version": "1.0.0",
            "description": "Frontend page for user registration"
          },
          "paths": {
            "/sign-up": {
              "get": {
                "summary": "Display sign-up page",
                "description": "Renders the Clerk sign-up component with custom styling. Supports optional redirect_url query parameter.",
                "parameters": [
                  {
                    "name": "redirect_url",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    },
                    "description": "URL to redirect to after successful sign-up. Defaults to /dashboard."
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Sign-up page rendered successfully"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "User Model",
        "description": "MongoDB schema for user data. Stores user information synced from Clerk including clerkId, email, firstName, lastName, and imageUrl. Uses Mongoose for database operations.",
        "files": [
          "src/models/User.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "User Model",
            "version": "1.0.0",
            "description": "MongoDB schema definition for user data"
          },
          "components": {
            "schemas": {
              "User": {
                "type": "object",
                "properties": {
                  "clerkId": {
                    "type": "string",
                    "description": "Unique Clerk user identifier",
                    "required": true
                  },
                  "email": {
                    "type": "string",
                    "description": "User email address",
                    "required": true
                  },
                  "firstName": {
                    "type": "string",
                    "description": "User first name"
                  },
                  "lastName": {
                    "type": "string",
                    "description": "User last name"
                  },
                  "imageUrl": {
                    "type": "string",
                    "description": "URL to user profile image"
                  },
                  "createdAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp when user was created"
                  },
                  "updatedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp when user was last updated"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
